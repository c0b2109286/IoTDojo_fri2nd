# Flask ダッシュボード


### 概要

このアプリケーションは、ある場所の様々な施設、特にトイレとゴミ箱を視覚的に表現します。マップのレンダリングには `folium` パッケージを、ウェブインタフェースには `Flask` を使用している。このアプリケーションはSQLiteデータベースとも統合しており、これらの施設やその状況に関するデータを保存したり取得したりすることができる。

### ディレクトリ

1. **image**: アイコンやその他の画像が保存されています。
2. **instance**: センサー、経路、基本情報などのデータベースが含まれています。
3. **static**: CSSやJavaScriptのファイルが保存されています。
4. **templates**: ダッシュボードを表示するためのHTMLファイルが保存されています。

### ファイル

1. **app.py**: ダッシュボードを実行する基幹プログラムです。
2. **nomal.py**: `app.py` と `userdb.py` を並列処理するためのプログラムです。
3. **userdb.py**: データベース操作を行うためのファイルです。



### 特徴

1. **マッピング設備:** このアプリケーションは、地図上にトイレ（ToiletA、ToiletB）とゴミ箱のマーカーを表示する。
2. **ステータス表示:** 施設（トイレとゴミ箱）には、データベースから取得されたステータスに応じて異なるアイコンが表示される。
3. **ユーザーインターフェース:** このアプリケーションは、ユーザーが施設のステータスを見ることができるウェブインターフェースを提供します。ステータスは異なる色/アイコンで表示されます。
4. **データベース統合:** このアプリケーションは `SQLAlchemy` を使って `location.db` という名前の SQLite データベースと接続している。

### データベース・モデル

1. **Post:** このモデルには、GPS座標と説明を含む、特定の場所に関する詳細が含まれています。
2. **Route:** センサーから送信されたパケットの経路情報が含まれています。
3. **Sensor:** さまざまな施設のセンサーデータが含まれており、読み取り値（ステータスを示す）、日付、時刻が含まれる。

### 主要機能

1. **mk_routing_table** 経路表を作成する関数
2. **mk_routes_num** 経路表からデータ送信に使用する経路をリストにする関数
3. **mk_all_node** 地図内に黒真を描くすべてのノードをリストにする関数
4. **mk_all_route** ノード同士のつながりをタプルにしてリストに格納する関数
5. **get_gps** ノードのIDに対するGPSを返答する関数
6. **get_num_gps** ノードのIDを地図上にプロットする際の位置（GPS）を返答する関数
7. **get_ins** ノードのIDに対する施設の情報を返答する関数
8. **get_ins_name** ノードのIDに対するセンサーの個別名を返答する関数
9. **mk_route** ノードのIDに対する使用する経路を返答する関数
10. **mk_route_txt** ノードの個別名に対する使用する経路のテキストを作成する関数
11. **judge_overlap** 経路に重なりが生じているかを返答する関数
12. **get_timeout_node** タイムアウトしているノードを返答する関数
13. **resp:** センサーの値から施設の状態を分析し、状態を返す。
14. **datetime_now:** 現在の日付と時刻を返します。
15. **reset_toilet:** データベース内のトイレのステータスをリセットする。
16. **usermap:** 施設の状況が表示されたメインページを表示します。
17. **userfoliummap:** 施設の状態を示すマーカーで地図を表示します。




### 必要条件

1. Python
2. Flask
3. SQLAlchemy
4. folium

### セットアップと実行

1. アプリケーションのあるディレクトリに移動します。
```
cd IoTDojo_fri2nd/flask
```
2. 仮想環境を作成します
```
python -m venv env
```
3. 仮想環境を立ち上げましょう
```
env\Script\actvate
```
4. モジュールをインストールします
```
pip install -r requirements.txt
```
5. アプリケーションの実行:
```
python app.py
```
6. ウェブブラウザを開き、`http://localhost:5000`にアクセスしてアプリケーションを表示する。

### 備考

1. このアプリケーションでは、カスタムアイコンを使用して設備の状態を表します。アイコン画像が指定されたディレクトリに存在することを確認してください。
2. 本番デプロイには、Flask開発サーバーではなく、よりスケーラブルなデータベースと本番用サーバーの使用を検討してください。

### ご意見・ご感想
提案、改善、バグレポートがあれば、遠慮なく課題を開くか、プルリクエストを提出してください。あなたのフィードバックは貴重です！


### 参考文献

- [【保存版】30分でFlask入門！Webアプリの作り方をPythonエンジニアが解説](https://tech-diary.net/flask-introduction/)
